name: "Build Docker Image"
description: "Builds a Docker image and saves it as a tarball"
inputs:
  registry:
    description: "Docker registry URL"
    required: true
  repository:
    description: "Docker repository name"
    required: true
  git_sha:
    description: "Git SHA of the built image"
    required: true

runs:
  using: "composite"
  steps:
    - name: Build Docker Image
      shell: bash
      run: |
        sbt clean compile app/docker:publishLocal
      env:
        GIT_SHA: ${{ input.git_sha }}

    - name: Save Docker Image
      shell: bash
      run: |
        docker save -o image.tar ${{ inputs.registry }}/${{ inputs.repository }}:${{ input.git_sha }}

    - name: Upload Docker Image
      uses: actions/upload-artifact@v4
      with:
        name: docker-image
        path: image.tar
